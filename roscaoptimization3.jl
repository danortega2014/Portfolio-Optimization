
γ = 2.0
β = 0.98
π_a = 0.70
π_b = 0.70
π_w = 0.50
w = 3.0



function ROSCA(x)
    obj = π_w*( (w -x[1] - x[2] + x[3])^(1-γ)/(1-γ) + β*π_a*(1.01*x[1]+1.08*x[2]-x[3])^(1-γ)/(1-γ) + β*(1-π_a)*(1.01*x[1]+0.98*x[2]-x[3])^(1-γ)/(1-γ) ) + (1-π_w)* ( (w -x[1] -x[2] -x[3])^(1-γ)/(1-γ) + β*π_b*(1.01*x[1]+.98*x[2]+x[3])^(1-γ)/(1-γ) + β*(1-π_b)*(1.01*x[1]+1.08*x[2]+x[3])^(1-γ)/(1-γ) )
    return -obj
end

#gradient/f.o.c
function g!(storage, x)
    storage[1] = π_w*( -(w -x[1] -x[2] + x[3])^(-γ) + β*π_a*1.01*(1.01*x[1]+1.08*x[2]-x[3])^(-γ) + β*(1-π_a)*1.01*(1.01*x[1]+0.98*x[2]-x[3])^(-γ) ) + (1-π_w)*( -(w -x[1] -x[2] -x[3])^(-γ) + β*π_b*1.01*(1.01*x[1]+.98*x[2]+x[3])^(-γ) + β*(1-π_b)*1.01*(1.01*x[1]+1.08*x[2]+x[3])^(-γ) )
    storage[2] = π_w*( -(w -x[1] -x[2] + x[3])^(-γ) + β*π_a*1.08*(1.01*x[1]+1.08*x[2]-x[3])^(-γ) + β*(1-π_a)*0.98*(1.01*x[1]+1.98*x[2]-x[3])^(-γ) ) + (1-π_w)*( -(w -x[1] -x[2] -x[3])^(-γ) + β*π_b*0.98*(1.01*x[1]+.98*x[2]+x[3])^(-γ) + β*(1-π_b)*1.08*(1.01*x[1]+1.08*x[2]+x[3])^(-γ) )
    storage[3] = π_w*( (w -x[1] -x[2] + x[3])^(-γ) - β*π_a*(1.01*x[1]+1.08*x[2]-x[3])^(-γ) - β*(1-π_a)*(1.01*x[1]+1.98*x[2]-x[3])^(-γ) ) + (1-π_w)*( -(w -x[1] -x[2] -x[3])^(-γ) + β*π_b*(1.01*x[1]+.98*x[2]+x[3])^(-γ) + β*(1-π_b)*(1.01*x[1]+1.08*x[2]+x[3])^(-γ) )
end


using Optim

# initial_x = [.1, .2, .2] #3.595600e-01
initial_x = [.1, .2, .5] 

lower = [0.0,0.0,0.0]
upper = [1.0, 1.0, 1.0]

results = optimize(ROSCA,g!, lower, upper, initial_x, Fminbox(GradientDescent()), Optim.Options(iterations=3000))

Optim.minimizer(results)